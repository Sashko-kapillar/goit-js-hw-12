{"version":3,"file":"index.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["'use strict';\n\nconst loader = document.querySelector('.loader');\n\nexport const apiKey = '46100469-a9a71a6d23d5188e64cb63582';\n\nexport const searchParams = new URLSearchParams({\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n});\n\nexport function toggleLoader(show) {\n  loader.style.display = show ? 'block' : 'none';\n}\n","'use strict';\n\nimport { apiKey, searchParams } from './render-functions';\nimport axios from 'axios';\n\nconst searchInput = document.querySelector('input[name=\"search\"]').value;\n\nexport async function fetchImages(searchInput, page, perPage) {\n  if (searchInput === '') {\n    iziToast.show({\n      // title: 'Error',\n      // message:\n      //   'Sorry, your search query is incorrect. Please, change something there!',\n      // color: 'red',\n      // position: 'topCenter',\n    });\n    return;\n  }\n  try {\n    const response = await axios.get(\n      `https://pixabay.com/api/?key=${apiKey}&q=${searchInput}&page=${page}&per_page=${perPage}`\n    );\n\n    return {\n      hits: response.data.hits,\n      total: response.data.total,\n    };\n  } catch (error) {\n    console.error('Помилка при отриманні даних з Pixabay:', error);\n    iziToast.show({\n      title: 'Помилка',\n      message:\n        'Виникла помилка при пошуку зображень. Будь ласка, спробуйте пізніше.',\n      color: 'red',\n      position: 'topCenter',\n    });\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport { fetchImages } from './js/pixabay-api';\nimport { toggleLoader } from './js/render-functions';\n\nconst searchForm = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\nlet loadMoreButton;\nconst perPage = 15; // Обмеження кількість завантажень до 15 зображень на сторінку\nlet page = 1;\nlet totalPages = 0; //загальна кількість сторінок\nconst lightbox = new SimpleLightbox('.gallery a');\nconst loader = document.querySelector('.loader');\n\n/* ==================================================================== */\n\nsearchForm.addEventListener('submit', async event => {\n  event.preventDefault();\n  const searchInput = document\n    .querySelector('input[name=\"search\"]')\n    .value.trim();\n  gallery.innerHTML = '';\n  if (loadMoreButton) {\n    loadMoreButton.remove();\n  }\n  if (toggleLoader) {\n    toggleLoader(false);\n  }\n  let loadedImages = 0; // Кількість завантажених зображень\n\n  page = 1;\n  toggleLoader(true);\n  try {\n    const { hits, total } = await fetchImages(searchInput, page, perPage); // деструктуризація\n    totalPages = Math.ceil(total / perPage);\n    console.log(totalPages);\n\n    if (hits.length === 0) {\n      iziToast.show({\n        title: 'Error',\n        message: 'Sorry, ваш запит якийсь дивний. Напишіть щось зрозуміле',\n        color: 'red',\n        position: 'topCenter',\n      });\n      return;\n    } else {\n      // toggleLoader(true);\n      const totalImages = hits.length;\n\n      hits.forEach(hit => {\n        const galleryItem = document.createElement('li');\n        galleryItem.classList.add('gallery-item');\n        galleryItem.innerHTML = `\n          <a href=\"${hit.largeImageURL}\">\n            <img src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" class=\"gallery-image\">\n          </a>\n        `;\n        gallery.appendChild(galleryItem);\n\n        // Оновлення прогресу завантаження після завантаження кожного зображення\n        const image = galleryItem.querySelector('.gallery-image');\n        image.onload = () => {\n          loadedImages++;\n          console.log(loadedImages);\n\n          if (loadedImages === totalImages) {\n            toggleLoader(false); // Приховати завантажувач після завантаження всіх зображень\n          }\n        };\n      });\n      lightbox.refresh();\n    }\n\n    if (hits.length >= perPage) {\n      loadMoreButton = document.createElement('button');\n      loadMoreButton.textContent = 'Load more';\n      loadMoreButton.classList.add('load-more');\n\n      gallery.after(loadMoreButton);\n    }\n\n    loadMoreButton.addEventListener('click', async () => {\n      const loadMoreBtn = document.querySelector('.load-more');\n      // Перемістимо loader після кнопки Load more\n      loadMoreBtn.parentNode.insertBefore(loader, loadMoreBtn);\n      page++;\n\n      const { hits } = await fetchImages(searchInput, page, perPage);\n      toggleLoader(true);\n      hits.forEach(hit => {\n        const galleryItem = document.createElement('li');\n        galleryItem.classList.add('gallery-item');\n        galleryItem.innerHTML = `\n          <a href=\"${hit.largeImageURL}\">\n            <img src=\"${hit.webformatURL}\" alt=\"${hit.tags}\" class=\"gallery-image\">\n          </a>\n        `;\n        gallery.appendChild(galleryItem);\n        console.log(loadedImages);\n        const image = galleryItem.querySelector('.gallery-image');\n        loadedImages = 0;\n        image.onload = () => {\n          loadedImages++;\n          console.log(loadedImages);\n          console.log(hits.length);\n          if (loadedImages === hits.length) {\n            toggleLoader(false); // Приховати завантажувач після завантаження всіх зображень\n          }\n        };\n      });\n      lightbox.refresh();\n      // toggleLoader(false);\n      const galleryItem = document.querySelector('.gallery-item');\n      if (galleryItem) {\n        const { height } = galleryItem.getBoundingClientRect();\n        window.scrollBy({\n          top: height * 2, // Прокрутка на дві висоти карточки\n          behavior: 'smooth', // Плавна прокрутка\n        });\n      }\n      if (page === totalPages) {\n        iziToast.show({\n          title: 'Infoline',\n          message: 'This is the last page',\n          color: 'green',\n          position: 'topCenter',\n        });\n        loadMoreButton.remove(); // Приховати кнопку, якщо це остання сторінка\n      }\n    });\n  } catch (error) {\n    iziToast.show({\n      title: 'Error',\n      message:\n        'Вибачте, ви нічого не написали зрозумілою мовою. Введіть людське слово для пошуку!',\n      color: 'red',\n      position: 'topCenter',\n    });\n    return; // у разі помилки нічого не робимо\n  } finally {\n  }\n});\n"],"names":["loader","apiKey","toggleLoader","show","fetchImages","searchInput","page","perPage","response","axios","error","searchForm","gallery","loadMoreButton","totalPages","lightbox","SimpleLightbox","event","loadedImages","hits","total","iziToast","totalImages","hit","galleryItem","image","loadMoreBtn","height"],"mappings":"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"}